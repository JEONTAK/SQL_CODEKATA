WITH TOTAL AS(
    SELECT COUNT(*) AS CNT
    FROM USER_INFO
    WHERE YEAR(JOINED) = 2021
    )

SELECT YEAR(S.SALES_DATE) AS YEAR,
    MONTH(S.SALES_DATE) AS MONTH,
    COUNT(DISTINCT I.USER_ID) AS PURCHASED_USERS,
    ROUND(COUNT(DISTINCT I.USER_ID) / T.CNT, 1) AS PUCHASED_RATIO
FROM USER_INFO AS I
    JOIN ONLINE_SALE AS S
ON I.USER_ID = S.USER_ID
    CROSS JOIN TOTAL AS T
GROUP BY 1, 2
ORDER BY 1, 2